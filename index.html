<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECrew - Absensi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .bg-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.1'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Hide the default file input */
        input[type="file"] { display: none; }
        .custom-file-upload {
            border: 1px solid #ccc;
            display: inline-block;
            padding: 6px 12px;
            cursor: pointer;
            background-color: #f9f9f9;
            border-radius: 0.5rem;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <div id="app" class="min-h-screen flex items-center justify-center bg-pattern p-4">

        <!-- Login Page -->
        <div id="login-page" class="w-full max-w-md fade-in">
            <div class="bg-white rounded-2xl shadow-xl p-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-slate-900">ECrew - Absensi</h1>
                    <p class="text-slate-500 mt-2">Selamat Datang di Portal Karyawan Transwisata</p>
                </div>
                <form id="login-form">
                    <div class="space-y-6">
                        <div>
                            <label for="username" class="block text-sm font-medium text-slate-700 mb-1">Username</label>
                            <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"><i data-lucide="user" class="h-5 w-5 text-slate-400"></i></span><input type="text" id="username" name="username" placeholder="Masukkan username Anda" class="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required></div>
                        </div>
                        <div>
                            <label for="password" class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                             <div class="relative"><span class="absolute inset-y-0 left-0 flex items-center pl-3"><i data-lucide="lock" class="h-5 w-5 text-slate-400"></i></span><input type="password" id="password" name="password" placeholder="Masukkan password Anda" class="w-full pl-10 pr-4 py-2.5 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" required></div>
                        </div>
                    </div>
                    <div id="error-message" class="text-red-500 text-sm mt-4 text-center hidden"></div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105 mt-8">Log In</button>
                </form>
                 <p class="text-center text-xs text-slate-400 mt-6">&copy; 2024 Transwisata. All rights reserved.</p>
            </div>
        </div>

        <!-- Dashboard Page -->
        <div id="dashboard-page" class="w-full max-w-5xl hidden fade-in">
            <div class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
                <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
                    <div>
                        <h1 class="text-2xl md:text-3xl font-bold text-slate-900">Dashboard</h1>
                        <p id="welcome-message" class="text-slate-500 mt-1">Memuat data...</p>
                    </div>
                    <button id="logout-button" class="mt-4 md:mt-0 flex items-center gap-2 bg-slate-100 text-slate-600 font-semibold py-2 px-4 rounded-lg hover:bg-slate-200 transition"><i data-lucide="log-out" class="h-4 w-4"></i><span>Logout</span></button>
                </header>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div id="absen-card" class="card-hover bg-gradient-to-br from-blue-500 to-blue-600 text-white p-6 rounded-xl flex flex-col justify-between cursor-pointer"><h2 class="text-xl font-bold">Absensi Hari Ini</h2></div>
                    <div id="riwayat-card" class="card-hover bg-white border border-slate-200 p-6 rounded-xl cursor-pointer"><h2 class="text-xl font-bold text-slate-800">Riwayat Absen</h2></div>
                    <div id="news-card" class="card-hover bg-white border border-slate-200 p-6 rounded-xl cursor-pointer"><h2 class="text-xl font-bold text-slate-800">Update News</h2></div>
                </div>

                <div id="content-area" class="bg-slate-50 p-6 rounded-lg min-h-[300px]">
                    <!-- Dynamic content will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Custom Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50"><div id="modal-content" class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center fade-in"><div id="modal-icon" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4"><i data-lucide="check" class="h-6 w-6 text-green-600"></i></div><h3 id="modal-title" class="text-lg font-medium text-gray-900">Berhasil!</h3><p id="modal-message" class="text-sm text-gray-500 mt-2">Aksi Anda telah berhasil diproses.</p><button id="modal-close" class="mt-4 w-full bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700">Tutup</button></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        lucide.createIcons();

        // --- Elements ---
        const loginPage = document.getElementById('login-page');
        const dashboardPage = document.getElementById('dashboard-page');
        const loginForm = document.getElementById('login-form');
        const errorMessage = document.getElementById('error-message');
        const welcomeMessage = document.getElementById('welcome-message');
        const logoutButton = document.getElementById('logout-button');
        const contentArea = document.getElementById('content-area');

        // --- Mock User Data (Expanded) ---
        const users = {
            'budi.santoso': { password: 'password123', name: 'Budi Santoso', email: 'budi.s@transwisata.com', division: 'Operasional', position: 'Tour Guide', duty: 'Field Operations' },
            'siti.aminah': { password: 'password123', name: 'Siti Aminah', email: 'siti.a@transwisata.com', division: 'Marketing', position: 'Digital Marketer', duty: 'Campaign Management' },
        };
        
        let currentUser = null;
        // --- State for Attendance ---
        let attendanceState = {
            clockInTime: null,
            clockOutTime: null,
            photoIn: null,
            locationIn: null,
            locationOut: null,
            workReportPhoto: null
        };
        let cameraStream = null;

        // --- Functions ---
        const showPage = (page) => {
            loginPage.classList.add('hidden');
            dashboardPage.classList.add('hidden');
            page.classList.remove('hidden');
        };

        const showModal = (title, message, isSuccess = true) => {
            const modal = document.getElementById('modal');
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-message').textContent = message;
            const iconContainer = document.getElementById('modal-icon');
            iconContainer.innerHTML = isSuccess ? '<i data-lucide="check" class="h-6 w-6 text-green-600"></i>' : '<i data-lucide="x-circle" class="h-6 w-6 text-red-600"></i>';
            iconContainer.className = `mx-auto flex items-center justify-center h-12 w-12 rounded-full mb-4 ${isSuccess ? 'bg-green-100' : 'bg-red-100'}`;
            lucide.createIcons();
            modal.classList.remove('hidden');
        };
        const hideModal = () => document.getElementById('modal').classList.add('hidden');

        const handleLogin = (e) => {
            e.preventDefault();
            const username = loginForm.username.value.trim();
            const password = loginForm.password.value;
            errorMessage.classList.add('hidden');
            const user = users[username];
            if (user && user.password === password) {
                currentUser = user;
                welcomeMessage.textContent = `Selamat datang kembali, ${user.name}!`;
                showPage(dashboardPage);
                updateContent('welcome');
            } else {
                errorMessage.textContent = 'Username atau password salah.';
                errorMessage.classList.remove('hidden');
            }
        };

        const handleLogout = () => {
            stopCamera();
            currentUser = null;
            attendanceState = { clockInTime: null, clockOutTime: null, photoIn: null, locationIn: null, locationOut: null, workReportPhoto: null };
            loginForm.reset();
            showPage(loginPage);
        };

        const formatTime = (date) => date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        const formatDate = (date) => date.toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        const startCamera = async () => {
            const video = document.getElementById('camera-preview');
            const startBtn = document.getElementById('start-camera-btn');
            const captureBtn = document.getElementById('capture-photo-btn');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                try {
                    cameraStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                    video.srcObject = cameraStream;
                    video.classList.remove('hidden');
                    startBtn.classList.add('hidden');
                    captureBtn.classList.remove('hidden');
                } catch (error) {
                    showModal('Error Kamera', 'Tidak dapat mengakses kamera. Pastikan Anda memberikan izin.', false);
                }
            }
        };

        const stopCamera = () => {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
        };

        const capturePhoto = () => {
            const video = document.getElementById('camera-preview');
            const canvas = document.getElementById('photo-canvas');
            const capturedImage = document.getElementById('captured-image');
            const context = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            attendanceState.photoIn = canvas.toDataURL('image/png');
            capturedImage.src = attendanceState.photoIn;
            capturedImage.classList.remove('hidden');
            video.classList.add('hidden');
            document.getElementById('capture-photo-btn').classList.add('hidden');
            stopCamera();
        };

        const getLocation = (elementId) => {
            const el = document.getElementById(elementId);
            if (navigator.geolocation) {
                el.textContent = 'Mencari lokasi...';
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const { latitude, longitude } = position.coords;
                        const location = { lat: latitude, lon: longitude };
                        if (elementId.includes('in')) attendanceState.locationIn = location;
                        else attendanceState.locationOut = location;
                        el.innerHTML = `Lat: ${latitude.toFixed(5)}, Lon: ${longitude.toFixed(5)} <i data-lucide="check-circle" class="inline-block h-4 w-4 text-green-500"></i>`;
                        lucide.createIcons();
                    },
                    () => {
                        el.textContent = 'Gagal mendapatkan lokasi.';
                        showModal('Error Lokasi', 'Tidak dapat mengakses lokasi. Pastikan GPS dan izin lokasi aktif.', false);
                    }
                );
            } else {
                el.textContent = 'Geolocation tidak didukung.';
            }
        };

        const handleClockIn = () => {
            if (!attendanceState.photoIn) {
                showModal('Validasi Gagal', 'Harap ambil foto selfie terlebih dahulu.', false);
                return;
            }
            if (!attendanceState.locationIn) {
                showModal('Validasi Gagal', 'Harap dapatkan lokasi Anda terlebih dahulu.', false);
                return;
            }

            attendanceState.clockInTime = new Date();
            showModal('Absen Masuk Berhasil', `Terima kasih, ${currentUser.name}. Kehadiran Anda telah dicatat.`);
            updateContent('absen');
        };

        const handleClockOut = () => {
            const remark = document.getElementById('remark').value;
            if (!remark.trim()) {
                 showModal('Validasi Gagal', 'Harap isi remark pekerjaan hari ini.', false);
                return;
            }
             if (!attendanceState.workReportPhoto) {
                showModal('Validasi Gagal', 'Harap unggah foto pekerjaan hari ini.', false);
                return;
            }
            if (!attendanceState.locationOut) {
                showModal('Validasi Gagal', 'Harap dapatkan lokasi pulang Anda terlebih dahulu.', false);
                return;
            }

            attendanceState.clockOutTime = new Date();
            showModal('Absen Pulang Berhasil', 'Absen pulang Anda telah berhasil dicatat. Selamat beristirahat!');
            updateContent('absen');
        };
        
        const updateContent = (menu) => {
            stopCamera(); // Stop camera whenever content changes
            let contentHTML = '';
            switch (menu) {
                case 'absen':
                    const now = new Date();
                    const clockInTime = attendanceState.clockInTime;
                    const clockOutTime = attendanceState.clockOutTime;

                    let clockInStatus = '', clockInStatusColor = '', lateReasonHTML = '';
                    if (clockInTime) {
                        const clockInHour = clockInTime.getHours();
                        const clockInMinute = clockInTime.getMinutes();
                        if (clockInHour < 9 || (clockInHour === 9 && clockInMinute === 0)) {
                            clockInStatus = 'Terima Kasih Anda Telah Absen Tepat Waktu';
                            clockInStatusColor = 'text-green-600';
                        } else {
                            clockInStatus = 'Anda Terlambat Absen';
                            clockInStatusColor = 'text-red-600';
                            lateReasonHTML = `<div class="mt-4"><label for="late_reason" class="block text-sm font-medium text-slate-700">Alasan Terlambat</label><textarea id="late_reason" rows="2" class="mt-1 block w-full rounded-md border-slate-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm" placeholder="Jelaskan alasan keterlambatan Anda"></textarea></div>`;
                        }
                    }
                    
                    let clockOutStatus = '', clockOutStatusColor = '', overtimeHTML = '', totalWorkTimeHTML = '';
                    if (clockOutTime) {
                         const clockOutHour = clockOutTime.getHours();
                         const clockOutMinute = clockOutTime.getMinutes();
                         if (clockOutHour < 17) {
                            clockOutStatus = 'Anda Pulang Sebelum Waktunya';
                            clockOutStatusColor = 'text-yellow-600';
                         } else if (clockOutHour === 17 && clockOutMinute <= 30) {
                            clockOutStatus = 'Anda Pulang Tepat Waktu';
                            clockOutStatusColor = 'text-green-600';
                         } else {
                            clockOutStatus = 'Waktu Kerja Melebihi';
                            clockOutStatusColor = 'text-blue-600';
                            
                            const overtimeStart = new Date(clockOutTime);
                            overtimeStart.setHours(17, 30, 0, 0);
                            const diffMs = clockOutTime - overtimeStart;
                            if(diffMs > 0){
                                const diffHrs = Math.floor(diffMs / 3600000);
                                const diffMins = Math.floor((diffMs % 3600000) / 60000);
                                const diffSecs = Math.floor(((diffMs % 3600000) % 60000) / 1000);
                                overtimeHTML = `<p class="text-sm"><strong>Total Overtime:</strong> ${diffHrs} jam, ${diffMins} menit, ${diffSecs} detik</p>`;
                            }
                         }

                         const workDiffMs = clockOutTime - clockInTime;
                         const workHrs = Math.floor(workDiffMs / 3600000);
                         const workMins = Math.floor((workDiffMs % 3600000) / 60000);
                         const workSecs = Math.floor(((workDiffMs % 3600000) % 60000) / 1000);
                         totalWorkTimeHTML = `<p class="text-sm mt-2"><strong>Total Work Time:</strong> ${workHrs} jam, ${workMins} menit, ${workSecs} detik</p>`;
                    }

                    const userInfoHTML = `
                        <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm bg-slate-100 p-4 rounded-lg mb-6">
                            <p><strong>Nama:</strong> ${currentUser.name}</p>
                            <p><strong>Email:</strong> ${currentUser.email}</p>
                            <p><strong>Divisi:</strong> ${currentUser.division}</p>
                            <p><strong>Posisi:</strong> ${currentUser.position}</p>
                            <p class="col-span-2"><strong>Tugas:</strong> ${currentUser.duty}</p>
                            <p class="col-span-2"><strong>Tipe Kerja:</strong> Work From Office</p>
                        </div>`;

                    const clockInHTML = `
                        <div id="clock-in-section" class="${clockInTime ? 'hidden' : ''}">
                            <h3 class="font-bold text-lg mb-4 border-b pb-2">Absen Masuk</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <p class="font-semibold">Foto Masuk (Selfie)</p>
                                    <div class="mt-2 p-2 border-2 border-dashed rounded-lg text-center bg-white">
                                        <video id="camera-preview" class="w-full rounded-md hidden" autoplay playsinline></video>
                                        <canvas id="photo-canvas" class="hidden"></canvas>
                                        <img id="captured-image" class="w-full rounded-md hidden" alt="Captured Photo">
                                        <button id="start-camera-btn" class="w-full bg-slate-200 p-2 rounded-md hover:bg-slate-300">Buka Kamera</button>
                                        <button id="capture-photo-btn" class="w-full bg-blue-500 text-white p-2 rounded-md hover:bg-blue-600 hidden mt-2">Ambil Foto</button>
                                    </div>
                                </div>
                                <div>
                                    <p class="font-semibold">Lokasi Masuk</p>
                                    <div id="location-in" class="mt-2 p-3 bg-white rounded-md border text-slate-600">Lokasi belum diambil</div>
                                    <button id="get-location-in-btn" class="w-full bg-slate-200 p-2 rounded-md hover:bg-slate-300 mt-2">Dapatkan Lokasi</button>
                                    <div class="mt-4">
                                        <p class="font-semibold">Tanggal & Waktu Masuk</p>
                                        <p class="mt-2 p-3 bg-white rounded-md border">${formatDate(now)} - ${formatTime(now)}</p>
                                    </div>
                                </div>
                            </div>
                            <button id="clock-in-btn" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 transition">KIRIM ABSEN MASUK</button>
                        </div>`;

                    const clockOutHTML = `
                        <div id="clock-out-section" class="${!clockInTime || clockOutTime ? 'hidden' : ''}">
                             <h3 class="font-bold text-lg mb-4 border-b pb-2">Absen Pulang</h3>
                             <div class="bg-green-50 border-l-4 border-green-500 text-green-700 p-4 rounded-md mb-6" role="alert">
                                <p class="font-bold">Absen Masuk Tercatat</p>
                                <p>Pada ${clockInTime ? formatDate(clockInTime) + ' - ' + formatTime(clockInTime) : ''}</p>
                                <p class="font-semibold mt-1 ${clockInStatusColor}">${clockInStatus}</p>
                             </div>
                             ${lateReasonHTML}
                            <div class="grid md:grid-cols-2 gap-6 mt-4">
                                <div>
                                    <label class="font-semibold block mb-2">Remark Pekerjaan Hari Ini</label>
                                    <textarea id="remark" rows="4" class="w-full rounded-md border-slate-300" placeholder="Jelaskan pekerjaan yang telah Anda selesaikan hari ini..."></textarea>
                                </div>
                                <div>
                                    <label class="font-semibold block mb-2">Foto Pekerjaan Hari Ini (dari galeri)</label>
                                    <label for="work-photo-upload" class="custom-file-upload w-full text-center hover:bg-slate-200">
                                        <i data-lucide="upload" class="inline-block h-4 w-4"></i> Pilih File
                                    </label>
                                    <input id="work-photo-upload" type="file" accept="image/*"/>
                                    <img id="work-photo-preview" class="mt-2 w-full rounded-md hidden max-h-32 object-cover" alt="Work Photo Preview">
                                </div>
                            </div>
                             <div class="mt-4">
                                <p class="font-semibold">Lokasi Pulang</p>
                                <div id="location-out" class="mt-2 p-3 bg-white rounded-md border text-slate-600">Lokasi belum diambil</div>
                                <button id="get-location-out-btn" class="w-full bg-slate-200 p-2 rounded-md hover:bg-slate-300 mt-2">Dapatkan Lokasi</button>
                             </div>
                             <button id="clock-out-btn" class="w-full mt-6 bg-red-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-red-700 transition">KIRIM ABSEN PULANG</button>
                        </div>`;
                    
                    const summaryHTML = `
                        <div id="summary-section" class="${!clockOutTime ? 'hidden' : ''}">
                             <h3 class="font-bold text-lg mb-4 border-b pb-2">Ringkasan Absensi Hari Ini</h3>
                             <div class="bg-blue-50 border-l-4 border-blue-500 text-blue-800 p-4 rounded-md" role="alert">
                                <p class="font-bold">Absensi hari ini telah selesai.</p>
                                <p class="text-sm mt-4"><strong>Absen Masuk:</strong> ${clockInTime ? formatTime(clockInTime) : ''} <span class="font-semibold ${clockInStatusColor}">(${clockInStatus})</span></p>
                                <p class="text-sm"><strong>Absen Pulang:</strong> ${clockOutTime ? formatTime(clockOutTime) : ''} <span class="font-semibold ${clockOutStatusColor}">(${clockOutStatus})</span></p>
                                ${totalWorkTimeHTML}
                                ${overtimeHTML}
                             </div>
                        </div>`;

                    contentHTML = `
                        <h2 class="text-xl font-bold mb-1">Formulir Absensi</h2>
                        <p class="text-slate-500 mb-6">Status Absen: <span class="font-semibold ${clockInTime && !clockOutTime ? 'text-green-600': 'text-slate-600'}">${clockInTime && !clockOutTime ? 'On Working' : (clockOutTime ? 'Selesai' : 'Belum Absen')}</span></p>
                        ${userInfoHTML}
                        ${clockInHTML}
                        ${clockOutHTML}
                        ${summaryHTML}
                    `;
                    break;
                case 'riwayat': contentHTML = `<h3 class="font-bold text-lg">Riwayat Absensi</h3><p>Fitur riwayat absensi akan segera tersedia.</p>`; break;
                case 'news': contentHTML = `<h3 class="font-bold text-lg">Update News</h3><p>Belum ada berita atau pengumuman terbaru.</p>`; break;
                default: contentHTML = `<h3 class="font-bold text-lg">Selamat Datang!</h3><p>Pilih menu di atas untuk memulai.</p>`;
            }
            contentArea.innerHTML = contentHTML;
            lucide.createIcons();
            // Add event listeners for new dynamic elements
            if (menu === 'absen') {
                if (!attendanceState.clockInTime) {
                    document.getElementById('start-camera-btn')?.addEventListener('click', startCamera);
                    document.getElementById('capture-photo-btn')?.addEventListener('click', capturePhoto);
                    document.getElementById('get-location-in-btn')?.addEventListener('click', () => getLocation('location-in'));
                    document.getElementById('clock-in-btn')?.addEventListener('click', handleClockIn);
                }
                if (attendanceState.clockInTime && !attendanceState.clockOutTime) {
                    document.getElementById('get-location-out-btn')?.addEventListener('click', () => getLocation('location-out'));
                    document.getElementById('clock-out-btn')?.addEventListener('click', handleClockOut);
                    document.getElementById('work-photo-upload')?.addEventListener('change', (e) => {
                        const file = e.target.files[0];
                        if (file) {
                            const reader = new FileReader();
                            reader.onload = (event) => {
                                attendanceState.workReportPhoto = event.target.result;
                                const preview = document.getElementById('work-photo-preview');
                                preview.src = attendanceState.workReportPhoto;
                                preview.classList.remove('hidden');
                            };
                            reader.readAsDataURL(file);
                        }
                    });
                }
            }
        };

        // --- Event Listeners ---
        loginForm.addEventListener('submit', handleLogin);
        logoutButton.addEventListener('click', handleLogout);
        document.getElementById('absen-card').addEventListener('click', () => updateContent('absen'));
        document.getElementById('riwayat-card').addEventListener('click', () => updateContent('riwayat'));
        document.getElementById('news-card').addEventListener('click', () => updateContent('news'));
        document.getElementById('modal-close').addEventListener('click', hideModal);
        document.getElementById('modal').addEventListener('click', (e) => { if(e.target.id === 'modal') hideModal(); });

        showPage(loginPage);
    });
    </script>
</body>
</html>
